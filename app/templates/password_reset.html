{% extends "base.html" %}

{% block title %}Password Reset{% endblock %}

{% block content %}
<h2>Reset Password</h2>
<form method = "POST" id="reset-password-form">
  <label>Confirm Current Password:</label><br>
  <input type="password" name="current_password" required><br>

  <label>New Password:</label><br>
  <input type="password" id="new_password" name="new_password" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
      title="Password must contain at least 8 characters (including a lowercase letter, uppercase letter, and number)"
  required><br>

  <label>Confirm New Password:</label><br>
  <input type="password" id="confirm_new_password" name="confirm_new_password" required><br><br>

  <button type = "submit">Reset Password</button><br>

  <h3>Password must contain the following:</h3>
  <ul>
    <li id="letter" class="invalid">A <b>lowercase</b> letter</li>
    <li id="capital" class="invalid">An <b>uppercase</b> letter</li>
    <li id="number" class="invalid">A <b>number</b></li>
    <li id="length" class="invalid">Minimum <b>8 characters</b></li>
  </ul>

  <a href="{{ url_for('auth.home') }}">Cancel</a>
</form>
{% endblock %}

{% block scripts %}
<script>
  const resetForm = document.getElementById('reset-password-form');
  const currentPasswordInput = document.getElementsByName('current_password')[0];
  const newPasswordInput = document.getElementById('new_password');
  const confirmNewPasswordInput = document.getElementById('confirm_new_password');

  function validateResetPasswords() {
    if (newPasswordInput.value !== confirmNewPasswordInput.value) {
      confirmNewPasswordInput.setCustomValidity('New passwords do not match');
    } else {
      confirmNewPasswordInput.setCustomValidity('');
    }

    if (
      currentPasswordInput.value &&
      newPasswordInput.value &&
      currentPasswordInput.value === newPasswordInput.value
    ) {
      newPasswordInput.setCustomValidity('New password must be different from current password');
    } else {
      newPasswordInput.setCustomValidity('');
    }
  }

  currentPasswordInput.addEventListener('input', validateResetPasswords);
  newPasswordInput.addEventListener('input', validateResetPasswords);
  confirmNewPasswordInput.addEventListener('input', validateResetPasswords);
  resetForm.addEventListener('submit', validateResetPasswords);
</script>
{% endblock %}
