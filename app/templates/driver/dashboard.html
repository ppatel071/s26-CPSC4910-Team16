{% extends "base.html" %}

{% block content %}

<h1>Driver Dashboard</h1>
<hr>

<h2>Total Points</h2>
<p><strong>Current Points:</strong> {{ current_user.driver.point_bal }}</p>

<hr>

<h2>Point History</h2>

<table border="1" cellpadding="6" cellspacing="0">
    <tr>
        <th>Date</th>
        <th>Points Changed</th>
        <th>Reason</th>
    </tr>

    {% for t in transactions %}
    <tr>
        <td>{{ t.create_time }}</td>
        <td>{{ t.point_change }}</td>
        <td>{{ t.reason }}</td>
    </tr>
    {% endfor %}
</table>

<hr>

<h2>My Orders</h2>

<table border="1" cellpadding="6" cellspacing="0">
    <tr>
        <th>Order ID</th>
        <th>Points Used</th>
        <th>Status</th>
        <th>Action</th>
    </tr>

    {% for order in orders %}
    <tr>
        <td>{{ order.order_id }}</td>
        <td>{{ order.point_cost }}</td>
        <td>{{ order.order_status }}</td>
        <td>
            {% if order.order_status.value != "CANCELLED" %}
            <form method="POST"
                  action="{{ url_for('driver.cancel_order', order_id=order.order_id) }}">
                <button type="submit">Cancel</button>
            </form>
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>

<hr>

<h2>Available Sponsor Organizations</h2>

{% for org in organizations %}
    {% if current_user.driver.organization is none or
          org.organization_id != current_user.driver.organization_id %}
        <div style="margin-bottom:10px;">
            <strong>{{ org.name }}</strong>

            <form method="POST"
                  action="{{ url_for('driver.apply_to_organization', organization_id=org.organization_id) }}"
                  style="display:inline;">
                <button type="submit">Apply</button>
            </form>
        </div>
    {% endif %}
{% endfor %}

<hr>

<h2>Request Sponsor Change</h2>

{% if current_user.driver.organization %}
<p>
    <strong>Current Organization:</strong>
    {{ current_user.driver.organization.name }}
</p>
{% endif %}

{% for org in organizations %}
    {% if current_user.driver.organization is none or
          org.organization_id != current_user.driver.organization_id %}
        <div style="margin-bottom:10px;">
            <strong>{{ org.name }}</strong>

            <form method="POST"
                  action="{{ url_for('driver.request_sponsor_change', organization_id=org.organization_id) }}"
                  style="display:inline;">
                <button type="submit">Request Change</button>
            </form>
        </div>
    {% endif %}
{% endfor %}

{% endblock %}